generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  role         UserRole @default(user)
  descuentoPct Float    @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Supplier {
  id         String      @id @default(uuid())
  name       String      @unique
  slug       String?     @unique
  websiteUrl String?
  isCrestron Boolean     @default(false)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  priceLists PriceList[]
  products   Product[]
}

model Product {
  id               String      @id @default(uuid())
  supplierId       String
  code             String
  name             String
  brand            String?
  family           String?
  description      String?
  photoUrl         String?
  stockMiami       Int?
  stockLaredo      Int?
  manufacturerInfo Json?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  priceItems       PriceItem[]
  supplier         Supplier    @relation(fields: [supplierId], references: [id])

  @@unique([supplierId, code])
}

model PriceList {
  id            String      @id @default(uuid())
  supplierId    String
  sourceLabel   String?
  sourceFileUrl String?
  effectiveDate DateTime    @default(now())
  rawCurrency   String      @default("USD")
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  priceItems    PriceItem[]
  supplier      Supplier    @relation(fields: [supplierId], references: [id])
}

model PriceItem {
  id           String    @id @default(uuid())
  priceListId  String
  productId    String
  basePriceUsd Float
  markupPct    Float     @default(0)
  impuestosPct Float     @default(0)
  ivaPct       Float     @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  priceList    PriceList @relation(fields: [priceListId], references: [id])
  product      Product   @relation(fields: [productId], references: [id])

  @@unique([priceListId, productId])
}

enum UserRole {
  admin
  user
}
